<!DOCTYPE html>
<html lang='ko' class='svgfilters csscalc cssgradients preserve3d supports svgclippaths svgasimg no-touchevents cssanimations boxsizing csstransforms csstransforms3d csstransitions svg'>

    <head>

    <meta charset='utf-8'>
<meta name='keywords' content='CLOUDZ LABS, DIGITAL LABS'>
<meta name='author' content='CLOUDZ LABS, DIGITAL LABS'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
<meta name='description' content='지난 챕터에서는 사용한 리소스를 기반으로 애플리케이션의 수를 자동으로 조절할 수 있는 HPA 라는 기능을 적용해 보았습니다. 그렇다면 애플리케이션에 Mysql 또는 Redis 등과 같은 서비스를 연동하고 싶을 땐 어떻게 해야할까요? Kubernetes에서는 애플리케이션에서 필요한 서비스를 Docker Image를 사용하여 바로 구성할 수 있습니다. 물론 대부분이 오픈소스 솔루션에 대한 서비스겠지요. Legacy에 있는 서비스들 역시 연동이 가능하긴 하지만, 여기서는 Docker Image 를 통해 Mysql DB를 구성하고 애플리케이션에 연동해보도록 하겠습니다.
샘플 애플리케이션에 대한 자세한 설명은 Spring의 Accessing data with MySQL 문서를 참고하시기 바랍니다.'>

<meta name="google-site-verification" content="vMW654gdULy3JNwnOIbbAqHdH3cQKdKH0ocV8OxP5cM" />

<meta property='og:title' content='[Kubernetes 활용(4/8)] Mysql DB 연동하기 | 김빛나'>
<meta property='og:description' content='지난 챕터에서는 사용한 리소스를 기반으로 애플리케이션의 수를 자동으로 조절할 수 있는 HPA 라는 기능을 적용해 보았습니다. 그렇다면 애플리케이션에 Mysql 또는 Redis 등과 같은 서비스를 연동하고 싶을 땐 어떻게 해야할까요? Kubernetes에서는 애플리케이션에서 필요한 서비스를 Docker Image를 사용하여 바로 구성할 수 있습니다. 물론 대부분이 오픈소스 솔루션에 대한 서비스겠지요. Legacy에 있는 서비스들 역시 연동이 가능하긴 하지만, 여기서는 Docker Image 를 통해 Mysql DB를 구성하고 애플리케이션에 연동해보도록 하겠습니다.
샘플 애플리케이션에 대한 자세한 설명은 Spring의 Accessing data with MySQL 문서를 참고하시기 바랍니다.'>
<meta property='og:url' content='http://tech.cloudz-labs.io/posts/kubernetes/backingservice/'>
<meta property='og:site_name' content='DIGITAL LABS'>
<meta property='og:type' content='article'><meta property='og:image' content='/images/default.png'><meta property='article:section' content='Posts'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='container'><meta property='article:tag' content='container orchestration'><meta property='article:tag' content='서비스 연동'><meta property='article:tag' content='db 연동'><meta property='article:tag' content='service discovery'><meta property='article:tag' content='k8s'><meta property='article:published_time' content='2018-05-08T15:23:03&#43;09:00'/><meta property='article:modified_time' content='2018-05-08T15:23:03&#43;09:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.53-DEV" />


    <title>[Kubernetes 활용(4/8)] Mysql DB 연동하기 | 김빛나</title>

    <link rel='canonical' href='http://tech.cloudz-labs.io/posts/kubernetes/backingservice/'>

    

    <link rel='icon' href='/favicon-blank.ico'>


<link rel='apple-touch-icon' href='touch-icon-iphone.png'>
<link rel='apple-touch-icon' sizes='152x152' href='touch-icon-ipad.png'>
<link rel='apple-touch-icon' sizes='180x180' href='touch-icon-iphone-retina.png'>
<link rel='apple-touch-icon' sizes='167x167' href='touch-icon-ipad-retina.png'>


<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

<link rel='stylesheet' href='/assets/css/main.f0e8df71.css'>

<link rel='stylesheet' href='/assets/css/bootstrap.css'><link rel='stylesheet' href='/assets/css/common.css'><link rel='stylesheet' href='/assets/css/font-awesome.css'><link rel='stylesheet' href='/assets/css/markdown.css'><link rel='stylesheet' href='/assets/css/mermaid.css'><style type="text/css">
:root #header + #content > #left > #rlblock_left{
    display:none !important;
}:not(pre) > code + span.copy-to-clipboard {
        display: none;
    }</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115004569-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


    <body naver_screen_capture_injected="true" class="hasScrollbar">

        
<div class="offcanvas-container" id="mobile-menu">
    <nav class="offcanvas-menu">
        <ul class="menu">
            <li class='has-children'>
                <span>
                    <a href='http://dtlabs.skcc.com/?utm_source=tech_blog&amp;utm_campaign=blog_about_us&amp;utm_content=menulink'>
                        <span>About Us</span>
                    </a>
                </span>
            </li>
            <li class='has-children'>
                <span>
                    <a href='/posts/'>
                        <span>Posts</span>
                    </a>
                </span>
            </li>
            
        </ul>
    </nav>
</div>
<div class="site-backdrop"></div>


<header class="navbar navbar-sticky">

    <div class="site-search" method="get">
    <input data-search-input id="search-by" type="text" name="site_search" placeholder="검색어를 3글자 이상 입력하세요.">
    <div class="search-tools">
        <span class="clear-search">Clear</span>
        <span class="close-search">
            <i class="icon-cross"></i>
        </span>
    </div>
</div>
<div class="site-branding">
    <div class="inner">
        <a class="offcanvas-toggle menu-toggle" href="#mobile-menu" data-toggle="offcanvas"></a>
        <a class="site-logo" href="http://tech.cloudz-labs.io/">Digital Labs Tech</a>
    </div>
</div>
<nav class='site-menu'>
    <ul>
        <li >
            <a href='http://dtlabs.skcc.com/?utm_source=tech_blog&amp;utm_campaign=blog_about_us&amp;utm_content=menulink'>
                <span>About Us</span>
            </a>
        </li>
        <li >
            <a href='/posts/'>
                <span>Posts</span>
            </a>
        </li>
        
    </ul>
</nav>

<div class="toolbar">
    <div class="tools">
        <div class="search">
            <i class="fa fa-search" aria-hidden="true"></i>
        </div>
    </div>
</div>


</header>



        

<div class="offcanvas-wrapper page-body">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row col-lg-12"><ul class="cover-byline">
    <li>
        <i class="fa fa-calendar" aria-hidden="true"></i>May 08, 2018
    </li>
    
    <li>
        <i class="fa fa-clock-o" aria-hidden="true"></i>
전체 읽기 6분 소요

    </li>
    
</ul>
</div>

                <div class="page-con"><h2>[Kubernetes 활용(4/8)] Mysql DB 연동하기</h2>
<p class="post-authorName">

    by&nbsp;<a href="/authors/blingeeeee">김빛나</a></p>


<p>지난 챕터에서는 사용한 리소스를 기반으로 애플리케이션의 수를 자동으로 조절할 수 있는 HPA 라는 기능을 적용해 보았습니다. <br/>그렇다면 애플리케이션에 Mysql 또는 Redis 등과 같은 서비스를 연동하고 싶을 땐 어떻게 해야할까요?<br/>
Kubernetes에서는 애플리케이션에서 필요한 서비스를 Docker Image를 사용하여 바로 구성할 수 있습니다.<br/> 물론 대부분이 오픈소스 솔루션에 대한 서비스겠지요.<br/>
Legacy에 있는 서비스들 역시 연동이 가능하긴 하지만, 여기서는 Docker Image 를 통해 Mysql DB를 구성하고 애플리케이션에 연동해보도록 하겠습니다.</p>

<p><strong>샘플 애플리케이션에 대한 자세한 설명은 Spring의 <a href="https://spring.io/guides/gs/accessing-data-mysql/" target="_blank">Accessing data with
MySQL</a> 문서를
참고하시기 바랍니다.</strong></p>

<h2 id="서비스-사용-워크플로우">서비스 사용 워크플로우</h2>

<hr />

<ol>
<li>Kubernetes에서 사용할 수 있는 서비스(Mysql, Redis 등등)는 <a href="https://store.docker.com/" target="_blank">Docker
Store</a>에서 공식 Image를 Pull받아 구성할
수 있습니다.</li>
<li>사용할 서비스의 Image를 선택한 후, 서비스를 생성합니다.</li>
<li>생성한 서비스를 사용하기를 원하는 애플리케이션에 서비스 연결 정보를
입력한 후, 동일한 Namespace에 애플리케이션을 배포하면 됩니다.</li>
<li>해당 Namespace에서 더 이상 서비스 인스턴스를 사용하지 않는다면
서비스를 삭제합니다.</li>
</ol>

<p>아래에서 서비스 워크플로우 단계별로 자세히 설명합니다. </p>

<h2 id="서비스-사용방법">서비스 사용방법</h2>

<hr />

<h3 id="서비스-생성">서비스 생성</h3>

<p>Kubernetes에서 서비스를 사용하기 위해 Docker Image를 통해 서비스를 생성합니다.</p>

<ol>
<li>Kubernetes 환경에서 사용할 Mysql DB 이미지를 검색합니다.</li>

<li><p><strong>Deployment YAML 파일</strong> 을 작성합니다.(spec.image 항목에 검색한
    Mysql DB Image 명을 적용)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">  apiVersion: apps/v1beta2
  kind: Deployment
  metadata:
    name: gs-mysql-data-deployment
    labels:
      app: gs-mysql-data
  spec:
    replicas: <span style="color:#ae81ff">1</span>
    selector:
      matchLabels:
        app: gs-mysql-data
    template:
      metadata:
        labels:
          app: gs-mysql-data
      spec:
        containers:
        - env:
          - name: MYSQL_DATABASE
            value: db_example
          - name: MYSQL_PASSWORD
            value: ThePassword
          - name: MYSQL_ROOT_PASSWORD
            value: root
          - name: MYSQL_USER
            value: springuser
          image: mysql
          imagePullPolicy: IfNotPresent 
          name: gs-mysql-data-container
          ports:
          - containerPort: <span style="color:#ae81ff">3306</span>
        restartPolicy: Always
  status: {}</code></pre></div>
<ol>
<li><strong>Service YAML 파일</strong>을 작성합니다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">  apiVersion: v1
  kind: Service
  metadata:
    name: gs-mysql-data
  spec:
    ports:
    - name: <span style="color:#e6db74">&#34;3306&#34;</span>
      port: <span style="color:#ae81ff">3306</span>
      targetPort: <span style="color:#ae81ff">3306</span>
    selector:
      app: gs-mysql-data
    type: NodePort</code></pre></div></li>

<li><p>Deployment와 Service Object를 생성합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  $ kubectl apply -f gs-mysql-data-deployment.yaml -f gs-mysql-data-service.yaml
  deployment <span style="color:#e6db74">&#34;gs-mysql-data&#34;</span> created
  service <span style="color:#e6db74">&#34;gs-mysql-data&#34;</span> created</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  $ kubectl get pod,svc,deployment
  NAME                                    READY     STATUS    RESTARTS   AGE
  po/gs-mysql-data-1903746765-26mlf       <span style="color:#ae81ff">1</span>/1       Running   <span style="color:#ae81ff">0</span>          8s

  NAME                        TYPE           CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>             AGE
  svc/gs-mysql-data           NodePort       <span style="color:#ae81ff">10</span>.0.0.19    &lt;none&gt;        <span style="color:#ae81ff">3306</span>:&lt;DB_PORT&gt;/TCP  8s

  NAME                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
  deploy/gs-mysql-data       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           8s</code></pre></div></li>

<li><p><code>kubectl exec</code> 명령어를 입력해 생성된 MySQL에
  springuser/ThePassword로 접속하여 DB가 정상적으로 동작하는지
  확인합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  $ kubectl exec -it gs-mysql-data-1903746765-26mlf bash 
  root@gs-mysql-data-1903746765-26mlf:/# mysql -u springuser -p
  Enter password: 
  Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
  Your MySQL connection id is <span style="color:#ae81ff">3</span>
  Server version: <span style="color:#ae81ff">5</span>.7.20 MySQL Community Server <span style="color:#f92672">(</span>GPL<span style="color:#f92672">)</span>


  Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2000</span>, <span style="color:#ae81ff">2017</span>, Oracle and/or its affiliates. All rights reserved.

  Oracle is a registered trademark of Oracle Corporation and/or its
  affiliates. Other names may be trademarks of their respective
  owners.

  Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.

  mysql&gt; <span style="color:#ae81ff">\u</span> db_example
  Database changed
  mysql&gt;</code></pre></div>
<h3 id="서비스-연결">서비스 연결</h3>

<p>애플리케이션에서 생성한 서비스를 사용하는 방법에 대해서 설명합니다. 생성한 서비스 명으로 애플리케이션과 연동합니다.<br/>
아래는 두가지의 서비스 디스커버리 방식에 대한 설명입니다.
해당 샘플에서는 환경변수 방식을 통해 연동해 보도록 하겠습니다.</p>

<h5 id="서비스-디스커버리-방식">서비스 디스커버리 방식</h5>

<ul>
<li>환경 변수 방식</li>
<li>Pod 생성 시 컨테이너 내부에 모든 서비스들의 HOST, PORT 정보가 환경변수로 주입됨</li>
<li>컨테이너에서 환경변수를 통해 다른 서비스에 대한 접속 정보를 알수 있음</li>
<li>redis-master 서비스가 미리 생성되어 있는 경우 , 애플리케이션을  Pod로 띄우면 내부에 아래와 같은 네이밍 룰에 따라 환경 변수가 주입됨
<img src="redis-master.png" alt="" /></li>
<li>DNS 서버 방식</li>
<li>Kubernetes에 DNS 서비스를 구성하고 서비스명으로 접근</li>
<li>예를 들면 호출 url이 redis-master:6379 와 같은 형태</li>
<li><strong>다른 네임스페이스에 있는 서비스도 접근 가능함</strong></li>
</ul>

<ol>
<li>애플리케이션의 설정파일에 서비스 정보 작성</li>
<li>아래 예제의 경우 Spring Boot 애플리케이션에서 gs-mysql-data 서비스를 사용하기 위해 <strong>application.properties</strong> 설정 파일에 작성한 정보입니다.<br /></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">spring.jpa.hibernate.ddl-auto=create
spring.datasource.url=jdbc:mysql://${GS_MYSQL_DATA_SERVICE_HOST}:${GS_MYSQL_DATA_SERVICE_PORT}/${MYSQL_DATABASE}
spring.datasource.username=${MYSQL_USER}
spring.datasource.password=${MYSQL_PASSWORD}</code></pre></div></li>
</ol>

<ul>
<li>연결할 서비스의 접속정보는 <strong>[서비스명]_SERVICE_HOST</strong> , <strong>[서비스명]_SERVICE_PORT</strong> 형태로 기입합니다. <br/></li>
<li>그외의 나머지 Credential 정보는 Container의 환경변수로 설정하고,애플리케이션에서는 주입받아 사용할 수 있도록 합니다.</li>
</ul>

<ol>
<li><p>Image 빌드(애플리케이션 컨테이너화)</p>

<ul>
<li>이미지를 정의하는 Dockerfile을 작성합니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM openjdk:8-jdk-alpine
ADD target/gs-mysql-data-0.1.0.jar app.jar
EXPOSE <span style="color:#ae81ff">8080</span> 
ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;-Djava.security.egd=file:/dev/./urandom&#34;</span>,<span style="color:#e6db74">&#34;-jar&#34;</span>,<span style="color:#e6db74">&#34;/app.jar&#34;</span><span style="color:#f92672">]</span></code></pre></div>
<p>위치는 다음과 같습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete $ tree  
.
├── Dockerfile
├── build.gradle
├── docker-compose.yml
├── gradle
├── gradlew
├── gradlew.bat
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
└── target</code></pre></div>
<ul>
<li><code>docker build</code> 명령어를 사용하여, 애플리케이션에 대한 Image를 구성합니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete $ docker build -t dtlabs/gs-mysql-data .
Sending build context to Docker daemon  <span style="color:#ae81ff">28</span>.26MB
Step <span style="color:#ae81ff">1</span>/4 : FROM openjdk:8-jdk-alpine
<span style="color:#ae81ff">8</span>-jdk-alpine: Pulling from library/openjdk
Digest: sha256:388566cc682f59a0019004c2d343dd6c69b83914dc5c458be959271af2761795
Status: Downloaded newer image <span style="color:#66d9ef">for</span> openjdk:8-jdk-alpine
  ---&gt; 3642e636096d
Step <span style="color:#ae81ff">2</span>/4 : ADD target/gs-mysql-data-0.1.0.jar app.jar
  ---&gt; 2419541c05c4
Step <span style="color:#ae81ff">3</span>/4 : EXPOSE <span style="color:#ae81ff">8080</span>
  ---&gt; Running in 4b6ef032a843
  ---&gt; e866f2e8876e
Removing intermediate container 4b6ef032a843
Step <span style="color:#ae81ff">4</span>/4 : ENTRYPOINT java -Djava.security.egd<span style="color:#f92672">=</span>file:/dev/./urandom -jar /app.jar
  ---&gt; Running in 824af86ada81
  ---&gt; 7bc04f36cf6a
Removing intermediate container 824af86ada81
Successfully built 7bc04f36cf6a
Successfully tagged dtlabs/gs-mysql-data:latest</code></pre></div>
<ol>
<li>Image를 Registry로 업로드</li>
<li>만들어진 Image를  <code>docker push</code> 명령어로 Registry에 Push합니다. 이전에 Push된 Image가 있을 경우, 변경된 Layer만 Push됩니다.<br /></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete $ docker push dtlabs/gs-mysql-dataㅁ
The push refers to a repository <span style="color:#f92672">[</span>docker.io/dtlabs/gs-mysql-data<span style="color:#f92672">]</span>
44630b8580cc: Pushed 
69cc5717c281: Layer already exists 
5b1e27e74327: Layer already exists 
04a094fe844e: Layer already exists 
latest: digest: sha256:c664a46b2341683aebcb8da9ea31e93df3c2225552dc38f494d664cfa39582d1 size: <span style="color:#ae81ff">1159</span></code></pre></div></li>

<li><p>Kubernetes 환경에 애플리케이션 배포(컨테이너)</p>

<ul>
<li>임의의 폴더를 생성하고 애플리케이션의 Deployment, Service Object 배포를 위한 YAML 파일들을 작성합니다.</li>
</ul>

<p><strong>gs-mysql-data-app-deployment.yaml</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">apiVersion: apps/v1beta2
kind: Deployment
metadata:
  name: gs-mysql-data-app-deployment
  labels:
    app: gs-mysql-data-app
spec:
  replicas: <span style="color:#ae81ff">1</span>
  selector:
    matchLabels:
      app: gs-mysql-data-app
  template:
    metadata:
      labels:
        app: gs-mysql-data-app
    spec:
      containers:
      - env:
        - name: MYSQL_DATABASE
          value: db_example
        - name: MYSQL_PASSWORD
          value: ThePassword        
        - name: MYSQL_USER
          value: springuser
        image: dtlabs/gs-mysql-data
        imagePullPolicy: IfNotPresent
        name: gs-mysql-data-app-container
        ports:
        - containerPort: <span style="color:#ae81ff">8080</span>
      restartPolicy: Always
status: {}</code></pre></div>
<p><strong>env</strong> 항목에 gs-mysql-data의 연결 정보를 설정합니다.</p>

<p><strong>gs-mysql-data-app-service.yaml</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">apiVersion: v1
kind: Service
metadata:
  name: gs-mysql-data-app
spec:
  ports:
  - name: <span style="color:#e6db74">&#34;8080&#34;</span>
    port: <span style="color:#ae81ff">8080</span>
    targetPort: <span style="color:#ae81ff">8080</span>
  selector:
    app: gs-mysql-data-app
  type: NodePort</code></pre></div>
<p>위치는 다음과 같습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete $ tree  
.
├── Dockerfile
├── build.gradle
├── docker-compose.yml
├── gradle
├── gradlew
├── gradlew.bat
├── kubernetes
│   ├── gs-mysql-data-app-deployment.yaml
│   ├── gs-mysql-data-app-service.yaml
├── mvnw
├── mvnw.cmd
├── pom.xml
├── src
└── target1</code></pre></div>
<ul>
<li>kubernetes 폴더로 이동하여, <code>kubectl apply</code> 명령어로 Kubernetes 환경에 애플리케이션을 배포합니다.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete/kubernetes $ kubectl apply -f gs-mysql-data-app-deployment.yaml -f gs-mysql-data-app-service.yaml
deployment <span style="color:#e6db74">&#34;gs-mysql-data-app&#34;</span> created
service <span style="color:#e6db74">&#34;gs-mysql-data-app&#34;</span> created</code></pre></div></li>
</ol>

<ul>
<li><p>kubectl get 명령어를 입력해 Pod, Service, Deployment가
제대로 생성되었는지 확인합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete/kubernetes $ kubectl get po,svc,deploy
NAME                                    READY     STATUS    RESTARTS   AGE
po/gs-mysql-data-1903746765-26mlf       <span style="color:#ae81ff">1</span>/1       Running   <span style="color:#ae81ff">0</span>          22m
po/gs-mysql-data-app-1364076206-0x3lp   <span style="color:#ae81ff">1</span>/1       Running   <span style="color:#ae81ff">0</span>          12m

NAME                        TYPE           CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>                  AGE
svc/gs-mysql-data           NodePort       <span style="color:#ae81ff">10</span>.0.0.19    &lt;none&gt;        <span style="color:#ae81ff">3306</span>:&lt;DB_PORT&gt;/TCP       22m
svc/gs-mysql-data-app       NodePort       <span style="color:#ae81ff">10</span>.0.0.25    &lt;none&gt;        <span style="color:#ae81ff">8080</span>:&lt;EXTERNAL_PORT&gt;/TCP  12m

NAME                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/gs-mysql-data       <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           22m
deploy/gs-mysql-data-app   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           12m</code></pre></div>
<h3 id="서비스-연결-확인">서비스 연결 확인</h3>

<p>컨테이너로 배포된 애플리케이션이 정상적으로 연결되는지 확인해보겠습니다.</p>

<ol>
<li>먼저 애플리케이션의 Pod 이름을 확인하고, <code>kubectl describe</code> 명령어로 생성된 Pod의 상세정보를 확인합니다. </li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete/kubernetes $ kubectl get pod
NAME                                 READY     STATUS    RESTARTS   AGE
gs-mysql-data-1903746765-26mlf       <span style="color:#ae81ff">1</span>/1       Running   <span style="color:#ae81ff">0</span>          25m
gs-mysql-data-app-1364076206-0x3lp   <span style="color:#ae81ff">1</span>/1       Running   <span style="color:#ae81ff">0</span>          15m 

/gs-accessing-data-mysql/complete/kubernetes $ kubectl describe pod gs-mysql-data-app-1364076206-0x3lp
Name:           gs-mysql-data-app-1364076206-0x3lp
Namespace:      default
Node:           poc.k8s-worker02.cloudz.co.kr/&lt;EXTERNAL_HOST&gt;

... 이하 생략 ...</code></pre></div>
<ol>
<li><code>kubectl get</code> 명령어로 Service 목록을 확인합니다. PORT(s) 항목에서 gs-mysql-data-app의 내부 Port는 8080, 외부 Port는 <strong>EXTERNAL_PORT</strong>로 설정되어 있는 것을 확인할 수 있습니다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete/kubernetes $ kubectl get svc
NAME                    TYPE           CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>                  AGE
gs-mysql-data           NodePort       <span style="color:#ae81ff">10</span>.0.0.19    &lt;none&gt;        <span style="color:#ae81ff">3306</span>:&lt;DB_PORT&gt;/TCP       30m
gs-mysql-data-app       NodePort       <span style="color:#ae81ff">10</span>.0.0.25    &lt;none&gt;        <span style="color:#ae81ff">8080</span>:&lt;EXTERNAL_PORT&gt;/TCP  20m</code></pre></div>
<ol>
<li><code>curl</code> 명령어로 <strong>gs-mysql-data-app</strong> 애플리케이션이 MySQL 서비스와 연동하여 정상적으로 동작하는지 확인합니다.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/gs-accessing-data-mysql/complete/kubernetes $ curl <span style="color:#e6db74">&#39;http://&lt;EXTERNAL_HOST&gt;:&lt;EXTERNAL_PORT&gt;/demo/all&#39;</span>
<span style="color:#f92672">[]</span>

/gs-accessing-data-mysql/complete/kubernetes $ curl <span style="color:#e6db74">&#39;http://&lt;EXTERNAL_HOST&gt;:&lt;EXTERNAL_PORT&gt;/demo/add?name=First&amp;email=someemail@someemailprovider.com&#39;</span> 
Saved

/gs-accessing-data-mysql/complete/kubernetes $ curl <span style="color:#e6db74">&#39;http://&lt;EXTERNAL_HOST&gt;:&lt;EXTERNAL_PORT&gt;/demo/all&#39;</span>                                                 
<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:1,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;First&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;someemail@someemailprovider.com&#34;</span><span style="color:#f92672">}]</span></code></pre></div></li>
</ul>

<h3 id="서비스-삭제">서비스 삭제</h3>

<p>더 이상 서비스를 사용하지 않는다면 Deployment와 Service를 삭제합니다.</p>

<ul>
<li><p>Kubernetes 설정 파일이 있는 폴더로 이동하여, <code>kubectl delete</code> 명령어로 Deployment와 Service를 삭제합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl delete -f gs-mysql-data-deployment.yaml -f gs-mysql-data-service.yaml
deployment <span style="color:#e6db74">&#34;gs-mysql-data&#34;</span> deleted
service <span style="color:#e6db74">&#34;gs-mysql-data&#34;</span> deleted</code></pre></div></li>
</ul>


<div class="series">
    <h3>함께 보기</h3>
    <ul>
        
        <li><a href="/posts/kubernetes/secret/">[Kubernetes 활용(7/8)] Secret</a></li>
        
        <li><a href="/posts/kubernetes/configmap/">[Kubernetes 활용(6/8)] ConfigMap</a></li>
        
        <li><a href="/posts/kubernetes/ingress/">[Kubernetes 활용(5/8)] Ingress</a></li>
        
        <li><a href="/posts/kubernetes/hpa/">[Kubernetes 활용(3/8)] HPA(오토스케일링)</a></li>
        
        <li><a href="/posts/kubernetes/rolling-update/">[Kubernetes 활용(2/8)] Rolling Update(무중단 배포)</a></li>
        
    </ul>
</div>

<div class="single-post-footer">

                        <ul class="tag"><li><a href="/tags/kubernetes" rel="tag">kubernetes</a></li><li><a href="/tags/container" rel="tag">container</a></li><li><a href="/tags/container-orchestration" rel="tag">container orchestration</a></li><li><a href="/tags/%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%97%B0%EB%8F%99" rel="tag">서비스 연동</a></li><li><a href="/tags/db-%EC%97%B0%EB%8F%99" rel="tag">db 연동</a></li><li><a href="/tags/service-discovery" rel="tag">service discovery</a></li><li><a href="/tags/k8s" rel="tag">k8s</a></li></ul>
<div class="share">
    <ul class="sns center">
        
        
        
        <li>
            <a class="social-button" href="//plus.google.com/share?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f" target="_blank" rel="noopener">
                <i class="fa fa-google-plus" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//twitter.com/share?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f&amp;text=%5bKubernetes%20%ed%99%9c%ec%9a%a9%284%2f8%29%5d%20Mysql%20DB%20%ec%97%b0%eb%8f%99%ed%95%98%ea%b8%b0" target="_blank" rel="noopener">
                <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f" target="_blank" rel="noopener">
                <i class="fa fa-facebook" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.linkedin.com/shareArticle?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f&amp;title=%5bKubernetes%20%ed%99%9c%ec%9a%a9%284%2f8%29%5d%20Mysql%20DB%20%ec%97%b0%eb%8f%99%ed%95%98%ea%b8%b0" target="_blank" rel="noopener">
                <i class="fa fa-linkedin" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f&amp;description=%5bKubernetes%20%ed%99%9c%ec%9a%a9%284%2f8%29%5d%20Mysql%20DB%20%ec%97%b0%eb%8f%99%ed%95%98%ea%b8%b0" target="_blank" rel="noopener">
                <i class="fa fa-pinterest-p" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="mailto:?subject=Check out this post by &amp;body=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fbackingservice%2f" target="_blank" rel="noopener">
                <i class="fa fa-envelope" aria-hidden="true"></i>
            </a>
        </li>
        
        
    </ul>
</div>
<div class="foot-author row">
                            <div class="col-lg-6 col-md-6 col-sm-12 ">
                                <div class="author">
                                    <a href="/authors/blingeeeee">

                                        <img class="img-circle" alt="" src='http://tech.cloudz-labs.io//images/authors/blingeeeee.png'/><div class="author-info">
    <h3>김빛나</h3>
    <p>Microservice Architecture Design</p>
</div>


                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
<section class="mt-30">

    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "digital-labs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>
</div>

                <div class="mt-30 row"><div class="col-md-6 post-pre"><a href='/posts/kubernetes/mariadb-utf8/'>
            <div class="author">
                <div class="author-info">이전&nbsp;페이지
                    <h2 class="post-title">Kubernetes에 구성한 MariaDB(Mysql)의 한글 깨짐 현상 해결방법</h2>
                    <ul class="cover-byline"><li><i class="fa fa-calendar" aria-hidden="true"></i>2018, May 08
                        <li><i class="fa fa-clock-o" aria-hidden="true"></i>
                        전체 읽기 6분 소요
                        </li>
                        
                    </ul>
                </div>
            </div>
        </a>
    </div><div class="col-md-6 post-next"><a href='/posts/kubernetes/ingress/'>
            <div class="author">
                <div class="author-info">다음&nbsp;페이지
                    <h2 class="post-title">[Kubernetes 활용(5/8)] Ingress</h2>
                    <ul class="cover-byline"><li><i class="fa fa-calendar" aria-hidden="true"></i>2018, May 08
                        <li><i class="fa fa-clock-o" aria-hidden="true"></i>
                        전체 읽기 6분 소요
                        </li>
                        
                    </ul>
                </div>
            </div>
        </a>
    </div></div>


            </div>
        </div>
    </div>
</div>



        <footer class="site-footer">
    <div class="container">

        <ul class="sns">

            <li>
        <a class='social-button' href='https://twitter.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-twitter' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='https://facebook.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-facebook' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='https://github.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-github' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='mailto:withdtlabs@gmail.com' target='_blank' rel='noopener'>
            <i class='fa fa-envelope' aria-hidden='true'></i></a>
    </li>

            

        </ul>

        <span class='copyright'><b>
            
        

         &copy; 2018
        SK 주식회사 C&amp;C <span>Digital Labs</span> All Rights Reserved.
</span></b>


    </div>
</footer>


        <a class="scroll-to-top-btn visible" href="#">
    <i class="fa fa-arrow-up" aria-hidden="true"></i>
</a>
<script src='/assets/js/main.5871befd.js'></script>

<script type="text/javascript">
    
        var baseurl = "http:\/\/tech.cloudz-labs.io\/";
    
</script><script src='/assets/js/common.js'></script><script src='/assets/js/scripts.js'></script><script src='/assets/js/lunr.min.js'></script><script src='/assets/js/auto-complete.js'></script><script src='/assets/js/search.js'></script><script src='/assets/js/clipboard.min.js'></script><script src='/assets/js/mermaid.js'></script></body>

</html>
