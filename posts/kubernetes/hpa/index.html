<!DOCTYPE html>
<html lang='ko' class='svgfilters csscalc cssgradients preserve3d supports svgclippaths svgasimg no-touchevents cssanimations boxsizing csstransforms csstransforms3d csstransitions svg'>

    <head>

    <meta charset='utf-8'>
<meta name='keywords' content='CLOUDZ LABS, DIGITAL LABS'>
<meta name='author' content='CLOUDZ LABS, DIGITAL LABS'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
<meta name='description' content='지난 챕터에서는 이미 배포되어 있는 애플리케이션을 무중단으로 업데이트하는 방법에 대해 보았습니다. 이번에는 이어서 애플리케이션을 자동으로 Scale-out 할수 있는 Horizontal Pod Autoscaler 기능을 적용해보도록 하겠습니다.
Horizontal Pod Autoscaler 란 Horizontal Pod Autoscaler는 지정된 CPU 사용률을 기반으로 Replication Controller, Deployment 또는 Replica Set의 Pod 수를 자동으로 조정합니다. Kubernetes에서는 CPU 자원에 대한 사용량을 다음과 같은 식으로 계산하여 Pod을 자동 Scale-out 할 수 있습니다.
[CPU example] TargetNumOfPods = ceil(sum(CurrentPodsCPUUtilization) / Target) 주기적으로 Pod의 자원 사용을 체크하고, 특정 시간의 여유를 두고 downscale/upscale이 이루어지는데, 이는 kube-controller-manager가 담당합니다.'>

<meta name="google-site-verification" content="vMW654gdULy3JNwnOIbbAqHdH3cQKdKH0ocV8OxP5cM" />

<meta property='og:title' content='[Kubernetes 활용(3/8)] HPA(오토스케일링) | 김빛나'>
<meta property='og:description' content='지난 챕터에서는 이미 배포되어 있는 애플리케이션을 무중단으로 업데이트하는 방법에 대해 보았습니다. 이번에는 이어서 애플리케이션을 자동으로 Scale-out 할수 있는 Horizontal Pod Autoscaler 기능을 적용해보도록 하겠습니다.
Horizontal Pod Autoscaler 란 Horizontal Pod Autoscaler는 지정된 CPU 사용률을 기반으로 Replication Controller, Deployment 또는 Replica Set의 Pod 수를 자동으로 조정합니다. Kubernetes에서는 CPU 자원에 대한 사용량을 다음과 같은 식으로 계산하여 Pod을 자동 Scale-out 할 수 있습니다.
[CPU example] TargetNumOfPods = ceil(sum(CurrentPodsCPUUtilization) / Target) 주기적으로 Pod의 자원 사용을 체크하고, 특정 시간의 여유를 두고 downscale/upscale이 이루어지는데, 이는 kube-controller-manager가 담당합니다.'>
<meta property='og:url' content='http://tech.cloudz-labs.io/posts/kubernetes/hpa/'>
<meta property='og:site_name' content='DIGITAL LABS'>
<meta property='og:type' content='article'><meta property='og:image' content='/images/default.png'><meta property='article:section' content='Posts'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='container'><meta property='article:tag' content='container orchestration'><meta property='article:tag' content='hpa'><meta property='article:tag' content='horizontal pod autoscaler'><meta property='article:tag' content='autoscale'><meta property='article:tag' content='scale out'><meta property='article:published_time' content='2018-02-22T14:41:49&#43;09:00'/><meta property='article:modified_time' content='2018-02-22T14:41:49&#43;09:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.53-DEV" />


    <title>[Kubernetes 활용(3/8)] HPA(오토스케일링) | 김빛나</title>

    <link rel='canonical' href='http://tech.cloudz-labs.io/posts/kubernetes/hpa/'>

    

    <link rel='icon' href='/favicon-blank.ico'>


<link rel='apple-touch-icon' href='touch-icon-iphone.png'>
<link rel='apple-touch-icon' sizes='152x152' href='touch-icon-ipad.png'>
<link rel='apple-touch-icon' sizes='180x180' href='touch-icon-iphone-retina.png'>
<link rel='apple-touch-icon' sizes='167x167' href='touch-icon-ipad-retina.png'>


<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

<link rel='stylesheet' href='/assets/css/main.f0e8df71.css'>

<link rel='stylesheet' href='/assets/css/bootstrap.css'><link rel='stylesheet' href='/assets/css/common.css'><link rel='stylesheet' href='/assets/css/font-awesome.css'><link rel='stylesheet' href='/assets/css/markdown.css'><link rel='stylesheet' href='/assets/css/mermaid.css'><style type="text/css">
:root #header + #content > #left > #rlblock_left{
    display:none !important;
}:not(pre) > code + span.copy-to-clipboard {
        display: none;
    }</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115004569-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>


    <body naver_screen_capture_injected="true" class="hasScrollbar">

        
<div class="offcanvas-container" id="mobile-menu">
    <nav class="offcanvas-menu">
        <ul class="menu">
            <li class='has-children'>
                <span>
                    <a href='http://dtlabs.skcc.com/?utm_source=tech_blog&amp;utm_campaign=blog_about_us&amp;utm_content=menulink'>
                        <span>About Us</span>
                    </a>
                </span>
            </li>
            <li class='has-children'>
                <span>
                    <a href='/posts/'>
                        <span>Posts</span>
                    </a>
                </span>
            </li>
            
        </ul>
    </nav>
</div>
<div class="site-backdrop"></div>


<header class="navbar navbar-sticky">

    <div class="site-search" method="get">
    <input data-search-input id="search-by" type="text" name="site_search" placeholder="검색어를 3글자 이상 입력하세요.">
    <div class="search-tools">
        <span class="clear-search">Clear</span>
        <span class="close-search">
            <i class="icon-cross"></i>
        </span>
    </div>
</div>
<div class="site-branding">
    <div class="inner">
        <a class="offcanvas-toggle menu-toggle" href="#mobile-menu" data-toggle="offcanvas"></a>
        <a class="site-logo" href="http://tech.cloudz-labs.io/">Digital Labs Tech</a>
    </div>
</div>
<nav class='site-menu'>
    <ul>
        <li >
            <a href='http://dtlabs.skcc.com/?utm_source=tech_blog&amp;utm_campaign=blog_about_us&amp;utm_content=menulink'>
                <span>About Us</span>
            </a>
        </li>
        <li >
            <a href='/posts/'>
                <span>Posts</span>
            </a>
        </li>
        
    </ul>
</nav>

<div class="toolbar">
    <div class="tools">
        <div class="search">
            <i class="fa fa-search" aria-hidden="true"></i>
        </div>
    </div>
</div>


</header>



        

<div class="offcanvas-wrapper page-body">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row col-lg-12"><ul class="cover-byline">
    <li>
        <i class="fa fa-calendar" aria-hidden="true"></i>Feb 22, 2018
    </li>
    
    <li>
        <i class="fa fa-clock-o" aria-hidden="true"></i>
전체 읽기 6분 소요

    </li>
    
</ul>
</div>

                <div class="page-con"><h2>[Kubernetes 활용(3/8)] HPA(오토스케일링)</h2>
<p class="post-authorName">

    by&nbsp;<a href="/authors/blingeeeee">김빛나</a></p>


<p>지난 챕터에서는 이미 배포되어 있는 애플리케이션을 무중단으로 업데이트하는 방법에 대해 보았습니다.<br/>
이번에는 이어서 애플리케이션을 자동으로 Scale-out 할수 있는 Horizontal Pod Autoscaler 기능을 적용해보도록 하겠습니다.</p>

<h2 id="horizontal-pod-autoscaler-란">Horizontal Pod Autoscaler 란</h2>

<hr />

<p>Horizontal Pod Autoscaler는 지정된 CPU 사용률을 기반으로 Replication Controller, Deployment 또는 Replica Set의 Pod 수를 자동으로 조정합니다.
<img src="hpa.png" alt="" />
Kubernetes에서는 CPU 자원에 대한 사용량을 다음과 같은 식으로 계산하여
Pod을 자동 Scale-out 할 수 있습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">[CPU example]

TargetNumOfPods = ceil(sum(CurrentPodsCPUUtilization) / Target)</pre></div>
<p>주기적으로 Pod의 자원 사용을 체크하고, 특정 시간의 여유를 두고
downscale/upscale이 이루어지는데, 이는 kube-controller-manager가
담당합니다. 아래와 같은 설정은 HPA 개별적으로 적용할 수 있는 부분은 아니고 kube-controller-manager에 적용이 된다면 클러스터 환경에 전체적으로 적용이 됩니다. Minikube의 경우 kube-controller-manager를 위한 설정 파일이 존재합니다. (/etc/kubernetes/manifests/kube-controller-manager.yaml)</p>

<p>kube-controller-manager는 Kubernetes 내 daemon 중 하나이고, default로
설정된 사항은 다음과 같습니다.</p>

<ul>
<li><p>&ndash;horizontal-pod-autoscaler-downscale-delay : 마지막 다운스케일 후 n시간 경과 후 다음 다운스케일 가능 (디폴트 5분)</p></li>

<li><p>&ndash;horizontal-pod-autoscaler-upscale-delay : 마지막 업스케일 후 m시간 경과 후 다음 업스케일 가능 (디폴트 3분)</p></li>

<li><p>&ndash;horizontal-pod-autoscaler-sync-period : 필요한 Pod 수 계산을 위한 시간 간격 설정 가능 (디폴트 30초)</p></li>
</ul>

<h2 id="horizontal-pod-autoscaler-적용하기">Horizontal Pod Autoscaler 적용하기</h2>

<hr />

<p>Horizontal Pod Autoscaler는 Kubernetes에서 축약어로 HPA 또는 hpa라고
부르기도 합니다.  HPA object 생성을 위한 yaml 파일을 통해 HPA를 적용 할
수 있습니다.</p>

<h3 id="resources-requests-설정-및-애플리케이션-배포">Resources Requests 설정 및 애플리케이션 배포</h3>

<p>HPA가 부하 발생에 따른 필요한 Pod의 수를 계산하기 위해 기준이 되는
Resources Requests 사용량을 설정해야 합니다. 최대 자원 사용량도
Deployment object yaml에 작성할 수 있습니다.</p>

<ol>
<li><p>Deployment를 통한 Resources Requests 설정
Deployment yaml 파일을 작성하고, containers 설정 부분에
resources.requests.cpu 부분에 CPU 자원을 200m(milli-cores) 또는
0.2로 요청합니다.</p>

<p><strong>gs-spring-boot-docker-deployment.yaml</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: apps/v1beta2 <span style="color:#75715e"># for versions before 1.8.0 use apps/v1beta1</span>
kind: Deployment
metadata:
  name: gs-spring-boot-docker-deployment
  labels:
    app: gs-spring-boot-docker
spec:
  replicas: <span style="color:#ae81ff">1</span>
  minReadySeconds: <span style="color:#ae81ff">10</span>
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: <span style="color:#ae81ff">25</span>%
  selector:
    matchLabels:
      app: gs-spring-boot-docker
  template:
    metadata:
      labels:
        app: gs-spring-boot-docker
    spec:
      containers:
      - name: gs-spring-boot-docker
        image: dtlabs/gs-spring-boot-docker:<span style="color:#ae81ff">1.0</span>
        imagePullPolicy: Always
        ports:
        - containerPort: <span style="color:#ae81ff">8080</span>
        resources:
          requests:
            memory: <span style="color:#e6db74">&#34;256Mi&#34;</span>
            cpu: <span style="color:#e6db74">&#34;200m&#34;</span>
          limits:
            memory: <span style="color:#e6db74">&#34;1Gi&#34;</span>
            cpu: <span style="color:#e6db74">&#34;500m&#34;</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># kubectl apply 명령어로 Deployment object 설정 변경을 적용 합니다.</span>
$ kubectl apply -f gs-spring-boot-docker-deployment.yaml
deployment <span style="color:#e6db74">&#34;gs-spring-boot-docker-deployment&#34;</span> configured</code></pre></div>
<p>  <br />
 </p></li>

<li><p>Service 생성</p>

<p><strong>gs-spring-boot-docker-service.yaml</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: gs-spring-boot-docker-service
spec:
  ports:
    - name: http
      port: <span style="color:#ae81ff">8081</span>
      targetPort: <span style="color:#ae81ff">8080</span>
  selector:
    app: gs-spring-boot-docker
  type: NodePort</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Service 생성</span>
<span style="color:#75715e"># kubectl apply 명령어에서 -f 옵션을 통해 파일명이 gs-spring-boot-docker-service.yaml 임을 인자로 전달합니다.</span>
$ kubectl apply -f ./gs-spring-boot-docker-service.yaml
service <span style="color:#e6db74">&#34;gs-spring-boot-docker-service&#34;</span> created</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Service object 조회를 통해 NodePort를 알아냅니다.</span>
<span style="color:#75715e"># 8081:30993/TCP 에서 30993이 외부로 노출된 NodePort 입니다.</span>
$ kubectl get svc
NAME                            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
gs-spring-boot-docker-service   NodePort    <span style="color:#ae81ff">10</span>.99.197.147   &lt;none&gt;        <span style="color:#ae81ff">8081</span>:30993/TCP   12m
kubernetes                      ClusterIP   <span style="color:#ae81ff">10</span>.96.0.1       &lt;none&gt;        <span style="color:#ae81ff">443</span>/TCP          14d</code></pre></div>
<h3 id="horizontalpodautoscaler-생성">HorizontalPodAutoscaler 생성</h3>

<ol>
<li>[애플리케이션명]-hpa.yaml 파일 생성</li>
</ol>

<p>테스트하기 위한 애플리케이션명은 &lsquo;gs-spring-boot-docker&rsquo; 입니다.
여기에 suffix로 &lsquo;-hpa&rsquo;를 추가 합니다. suffix는 선택사항으로 필수는
아닙니다.</p>

<p>이 문서에서는 &lsquo;gs-spring-boot-docker&rsquo; 이름의 애플리케이션에 대한
&lsquo;hpa&rsquo; object 생성을 위한 yaml이라는 의미로
gs-spring-boot-docker-hpa.yaml 파일을 생성합니다.</p>

<p><strong>gs-spring-boot-docker-hpa.yaml</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: gs-spring-boot-docker-hpa
spec:
  maxReplicas: <span style="color:#ae81ff">10</span>
  minReplicas: <span style="color:#ae81ff">1</span>
  scaleTargetRef:
    apiVersion: apps/v1beta2
    kind: Deployment
    name: gs-spring-boot-docker-deployment
  targetCPUUtilizationPercentage: <span style="color:#ae81ff">50</span></code></pre></div>
<h6 id="line1-apiversion">line1 apiVersion</h6>

<p>API Server에서 관리되는 API 버전을 나타냅니다. 사용자가
입력한 apiVersion에 맞는 API를 사용하게 됩니다. Kubernetes API는
실험 단계의 API를 &lsquo;beta&rsquo; 형태로 지원하고, 지속 업데이트 하고
있습니다. 따라서 Kubernetes API 공식문서를 통해 현재 사용자의
Kubernetes 버전 별 호환 및 사용 가능한 API를 확인 후 사용해야
합니다. 현재 HPA의 경우 stable 버전(autoscaling/v1)에서는 CPU 리소스에 대해서만 오토스케일링을 지원하며, beta버전(autoscaling/v2beta1)에서 Memory 또는 사용자의 custom metrics 등의 리소스를 추가적으로 지원하고 있습니다.</p>

<h6 id="line2-kind">line2 kind</h6>

<p>현재 yaml이 어떤 object를 생성하기 위함인지 kind에 설정합니다. kind:
HorizontalPodAutoscaler 설정을 통해 현재 yaml로
HorizontalPodAutoscaler object를 생성하게 됩니다.</p>

<h6 id="line3-metadata">line3 metadata</h6>

<p>HorizontalPodAutoscaler object 자신의 고유 정보를 입력합니다.</p>

<h6 id="line4-metadata-name">line4 metadata.name</h6>

<p>HorizontalPodAutoscaler object에 대한 Unique-key를 입력합니다. 이
name 값을 통해 여러 object 중 해당 name을 갖는 object를 조회할 수
있습니다.</p>

<h6 id="line5-spec">line5 spec</h6>

<p>HorizontalPodAutoscaler object가 수행하는 내용에 대한 설정 입니다.</p>

<h6 id="line6-spec-maxreplicas">line6 spec.maxReplicas</h6>

<p>업스케일 시 생성할 수 있는 Pod의 최대수를 설정합니다.</p>

<h6 id="line7-spec-minreplicas">line7 spec.minReplicas</h6>

<p>다운스케일 시 생성할 수 있는 Pod의 최소수를 설정합니다.</p>

<h6 id="line8-spec-scaletargetref">line8 spec.scaleTargetRef</h6>

<p>HorizontalPodAutoscaler object가 동작할 대상에 대한 설정 입니다.</p>

<h6 id="line9-spec-scaletargetref-apiversion">line9 spec.scaleTargetRef.apiVersion</h6>

<p>HorizontalPodAutoscaler object는 Deployment object 또는 ReplicaController object 등에 맵핑시킬 수
있고, 맵핑한 object의 apiVersion입니다.</p>

<h6 id="line10-spec-scaletargetref-kind">line10 spec.scaleTargetRef.kind</h6>

<p>HorizontalPodAutoscaler와 맵핑 될 object의 종류를 설정합니다. 해당 예제는 Deployment object가 관리하는 Pod을 대상으로 업스케일/다운스케일
됩니다.</p>

<h6 id="line11-spec-scaletargetref-name">line11 spec.scaleTargetRef.name</h6>

<p>HorizontalPodAutoscaler와 맵핑 될 Deployment object의 name을
설정 합니다.</p>

<h6 id="line12-spec-targetcpuutilizationpercentage">line12 spec.targetCPUUtilizationPercentage</h6>

<p>Pod에 설정된 CPU resource에 대한 request 설정 기준대비 CPU 사용
임계치를 퍼센트(%)로 설정하는데, 숫자만 입력 합니다. 해당 임계치를
넘어서면 업스케일이 동작하게 됩니다.</p></li>
</ol>

<div class="notices tip" ><p><strong>kubectl autoscale 명령어를 통한 생성</strong><br/>
  HPA object는 파일 기반으로 생성하는 것 외에 아래와 같은 명령어를 통해서도 생성이 가능합니다.</p>
</div>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  <span style="color:#75715e"># HorizontalPodAutoscaler 생성</span>
  $ kubectl autoscale deployment gs-spring-boot-docker-deployment --cpu-percent<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span> --min<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --max<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
  deployment <span style="color:#e6db74">&#34;gs-spring-boot-docker-deployment&#34;</span> autoscaled  </code></pre></div>
<p>그 밖의 HorizontalPodAutoscaler object yaml 파일 상세 작성 방법은
  HorizontalPodAutoscaler API 공식문서 를 참고 바랍니다.</p>

<ul>
<li><p>HorizontalPodAutoscaler 생성 확인</p>

<p>&lsquo;0% / 50%&lsquo;과 같이 사용량이 정상 표시 된 경우, <span
class="underline"><strong>Horizontal Pod Autoscaling의 준비가 완료된 것
입니다.</strong></span></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># HorizontalPodAutoscaler 생성</span>
$ kubectl apply -f ./gs-spring-boot-docker-hpa.yaml
horizontalpodautoscaler <span style="color:#e6db74">&#34;gs-spring-boot-docker-hpa&#34;</span> created

<span style="color:#75715e"># horizontalpodautoscaler 생성 확인</span>
<span style="color:#75715e"># &#39;kubectl get horizontalpodautoscaler&#39;와 &#39;kubectl get hpa&#39;는 동일한 의미 입니다.</span>
$ kubectl get hpa
NAME                        REFERENCE                                     TARGETS    MINPODS   MAXPODS   REPLICAS   AGE
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">0</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>          36m</code></pre></div>
<p>현재 사용량이 &lt;unknown&gt;인 경우가 발생할 수 있는데, 아래의
경우를 고려하여 사용량이 표시되도록 할 수 있습니다.</p>

<ul>
<li>일정 시간이 지나면, 사용량이 표시될 수 있습니다.</li>
<li>CPU resource에 대한 request 설정을 아직 하지 않았을 경우,
&lt;unknown&gt;으로 표시 됩니다.</li>
<li>CPU resource에 대한 request 설정을 하였고, 일정 시간이 지나도
&lt;unknown&gt;으로 표시된 경우, 부하를 발생시키면, 적당한
시간이 지나면 CPU 사용량이 표시됩니다.</li>
</ul>

<!-- -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">$ kubectl get hpa
NAME                        REFERENCE                                     TARGETS    MINPODS   MAXPODS   REPLICAS   AGE
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   &lt;unknown&gt; / 50%   1         10        1          36m</pre></div>
<h2 id="horizontal-pod-autoscaler-테스트">Horizontal Pod Autoscaler 테스트</h2>

<ol>
<li>사용량 모니터링 시작</li>
</ol>

<p><code>kubectl get hpa</code>  명령어에서 옵션으로 &lsquo;-w &lsquo;을 사용하게 되면, 실시간으로 갱신되는 정보를 지속 조회할 수 있습니다.
지속적인 모니터링을 위해 별개의 커맨드 창에서 수행하시기 바랍니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get hpa -w
NAME                        REFERENCE                                     TARGETS     MINPODS   MAXPODS   REPLICAS   AGE
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">27</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>          2d</code></pre></div></li>
</ul>

<ol>
<li><p>부하테스트</p>

<p>URL 요청 테스트를 위해 wget 커맨드를 통해 접속 테스트의 반복 요청을
합니다.</p>

<p>URL은 Node의 IP와 Service가 NodePort 방식을 통해 외부로 노출된 Port를 사용합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#66d9ef">while</span> true; <span style="color:#66d9ef">do</span> wget -q -O- http://169.56.109.58:30993; <span style="color:#66d9ef">done</span>
Hello Docker World
Hello Docker World
Hello Docker World
Hello Docker World
Hello Docker World
...</code></pre></div>
<ol>
<li>사용량에 따른 Pod Autoscaling 확인</li>
</ol>

<p>CPU 사용량이 27%에서 106%으로 설정한 기준값인 50%를 넘게 되면서 Pod
<span class="underline">REPLICAS가 1 -&gt; 3 으로 증가되고, 부하가
분산</span>되었습니다.</p>

<p>시간이 지남에 따라 CPU는 24%로 안정되는 것 또한 확인할 수 있습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get hpa -w
NAME                        REFERENCE                                     TARGETS     MINPODS   MAXPODS   REPLICAS   AGE
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">27</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>          2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">27</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>         2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">106</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">1</span>         2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">106</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">2</span>
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">35</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">3</span>         2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">35</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">3</span>         2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">24</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">3</span>         2d
gs-spring-boot-docker-hpa   Deployment/gs-spring-boot-docker-deployment   <span style="color:#ae81ff">24</span>% / <span style="color:#ae81ff">50</span>%   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">10</span>        <span style="color:#ae81ff">3</span>         2d</code></pre></div></li>
</ol>


<div class="series">
    <h3>함께 보기</h3>
    <ul>
        
        <li><a href="/posts/kubernetes/secret/">[Kubernetes 활용(7/8)] Secret</a></li>
        
        <li><a href="/posts/kubernetes/configmap/">[Kubernetes 활용(6/8)] ConfigMap</a></li>
        
        <li><a href="/posts/kubernetes/ingress/">[Kubernetes 활용(5/8)] Ingress</a></li>
        
        <li><a href="/posts/kubernetes/backingservice/">[Kubernetes 활용(4/8)] Mysql DB 연동하기</a></li>
        
        <li><a href="/posts/kubernetes/rolling-update/">[Kubernetes 활용(2/8)] Rolling Update(무중단 배포)</a></li>
        
    </ul>
</div>

<div class="single-post-footer">

                        <ul class="tag"><li><a href="/tags/kubernetes" rel="tag">kubernetes</a></li><li><a href="/tags/container" rel="tag">container</a></li><li><a href="/tags/container-orchestration" rel="tag">container orchestration</a></li><li><a href="/tags/hpa" rel="tag">hpa</a></li><li><a href="/tags/horizontal-pod-autoscaler" rel="tag">horizontal pod autoscaler</a></li><li><a href="/tags/autoscale" rel="tag">autoscale</a></li><li><a href="/tags/scale-out" rel="tag">scale out</a></li></ul>
<div class="share">
    <ul class="sns center">
        
        
        
        <li>
            <a class="social-button" href="//plus.google.com/share?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f" target="_blank" rel="noopener">
                <i class="fa fa-google-plus" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//twitter.com/share?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f&amp;text=%5bKubernetes%20%ed%99%9c%ec%9a%a9%283%2f8%29%5d%20HPA%28%ec%98%a4%ed%86%a0%ec%8a%a4%ec%bc%80%ec%9d%bc%eb%a7%81%29" target="_blank" rel="noopener">
                <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f" target="_blank" rel="noopener">
                <i class="fa fa-facebook" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.linkedin.com/shareArticle?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f&amp;title=%5bKubernetes%20%ed%99%9c%ec%9a%a9%283%2f8%29%5d%20HPA%28%ec%98%a4%ed%86%a0%ec%8a%a4%ec%bc%80%ec%9d%bc%eb%a7%81%29" target="_blank" rel="noopener">
                <i class="fa fa-linkedin" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f&amp;description=%5bKubernetes%20%ed%99%9c%ec%9a%a9%283%2f8%29%5d%20HPA%28%ec%98%a4%ed%86%a0%ec%8a%a4%ec%bc%80%ec%9d%bc%eb%a7%81%29" target="_blank" rel="noopener">
                <i class="fa fa-pinterest-p" aria-hidden="true"></i>
            </a>
        </li>
        

        
        
        <li>
            <a class="social-button" href="mailto:?subject=Check out this post by &amp;body=http%3a%2f%2ftech.cloudz-labs.io%2fposts%2fkubernetes%2fhpa%2f" target="_blank" rel="noopener">
                <i class="fa fa-envelope" aria-hidden="true"></i>
            </a>
        </li>
        
        
    </ul>
</div>
<div class="foot-author row">
                            <div class="col-lg-6 col-md-6 col-sm-12 ">
                                <div class="author">
                                    <a href="/authors/blingeeeee">

                                        <img class="img-circle" alt="" src='http://tech.cloudz-labs.io//images/authors/blingeeeee.png'/><div class="author-info">
    <h3>김빛나</h3>
    <p>Microservice Architecture Design</p>
</div>


                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
<section class="mt-30">

    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "digital-labs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>
</div>

                <div class="mt-30 row"><div class="col-md-6 post-pre"><a href='/posts/kubernetes/rolling-update/'>
            <div class="author">
                <div class="author-info">이전&nbsp;페이지
                    <h2 class="post-title">[Kubernetes 활용(2/8)] Rolling Update(무중단 배포)</h2>
                    <ul class="cover-byline"><li><i class="fa fa-calendar" aria-hidden="true"></i>2018, Feb 22
                        <li><i class="fa fa-clock-o" aria-hidden="true"></i>
                        전체 읽기 6분 소요
                        </li>
                        
                    </ul>
                </div>
            </div>
        </a>
    </div><div class="col-md-6 post-next"><a href='/posts/kubernetes_deploy_script/'>
            <div class="author">
                <div class="author-info">다음&nbsp;페이지
                    <h2 class="post-title">K8S App deploy script</h2>
                    <ul class="cover-byline"><li><i class="fa fa-calendar" aria-hidden="true"></i>2018, Feb 22
                        <li><i class="fa fa-clock-o" aria-hidden="true"></i>
                        전체 읽기 6분 소요
                        </li>
                        
                    </ul>
                </div>
            </div>
        </a>
    </div></div>


            </div>
        </div>
    </div>
</div>



        <footer class="site-footer">
    <div class="container">

        <ul class="sns">

            <li>
        <a class='social-button' href='https://twitter.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-twitter' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='https://facebook.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-facebook' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='https://github.com/cloudzlabs' target='_blank' rel='noopener'><i class='fa fa-github' aria-hidden='true'></i></a>
    </li><li>
        <a class='social-button' href='mailto:withdtlabs@gmail.com' target='_blank' rel='noopener'>
            <i class='fa fa-envelope' aria-hidden='true'></i></a>
    </li>

            

        </ul>

        <span class='copyright'><b>
            
        

         &copy; 2018
        SK 주식회사 C&amp;C <span>Digital Labs</span> All Rights Reserved.
</span></b>


    </div>
</footer>


        <a class="scroll-to-top-btn visible" href="#">
    <i class="fa fa-arrow-up" aria-hidden="true"></i>
</a>
<script src='/assets/js/main.5871befd.js'></script>

<script type="text/javascript">
    
        var baseurl = "http:\/\/tech.cloudz-labs.io\/";
    
</script><script src='/assets/js/common.js'></script><script src='/assets/js/scripts.js'></script><script src='/assets/js/lunr.min.js'></script><script src='/assets/js/auto-complete.js'></script><script src='/assets/js/search.js'></script><script src='/assets/js/clipboard.min.js'></script><script src='/assets/js/mermaid.js'></script></body>

</html>
